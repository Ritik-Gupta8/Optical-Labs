<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Optical Setup Designer</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/lucide@latest"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
    .font-inter { font-family: 'Inter', sans-serif; }
    [v-cloak] { display: none; }
    .grid-cell {
      transform: translate(-50%, -50%);
    }
    .component-icon {
      transform-origin: center;
    }
    .animate-ray-path {
      stroke-dasharray: 1000;
      stroke-dashoffset: 1000;
      animation: dash 5s linear forwards;
    }
    @keyframes dash {
      to {
        stroke-dashoffset: 0;
      }
    }
  </style>
</head>
<body class="bg-gray-100 font-inter p-4 md:p-8">

<div id="app" v-cloak>
  <header class="mb-6">
    <h1 class="text-3xl font-extrabold text-gray-900 flex items-center">
      <svg class="h-8 w-8 text-indigo-600 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
      </svg>
      Optical Bench Designer
    </h1>
    <p class="text-gray-500">Design your experiment and simulate light paths using Optical Bench Designer</p>
    <div v-if="message"
      :class="['mt-2 p-3 border rounded-lg text-sm transition-opacity duration-300',
              messageType === 'success'
                ? 'bg-green-100 border-green-400 text-green-700'
                : 'bg-red-100 border-red-400 text-red-700']">
      {{ message }}
    </div>
  </header>

  <div class="flex flex-col lg:flex-row gap-6">
    <!-- Left Panel -->
    <div class="w-full lg:w-1/4 space-y-6">
      <!-- Component Library -->
      <div class="bg-white p-4 rounded-xl shadow-lg border border-gray-200">
        <h2 class="text-xl font-bold mb-4 text-gray-700 border-b pb-2">Component Library</h2>
        <div class="space-y-3">
          <button
            v-for="type in COMPONENT_TYPES"
            :key="type.id"
            @click="placeComponent(type.id)"
            class="w-full flex items-center p-3 bg-indigo-50 hover:bg-indigo-100 rounded-lg transition-colors border border-indigo-200 shadow-sm">
            <i :class="['lucide', type.icon, 'text-indigo-600 mr-3']" style="width:20px;height:20px;"></i>
            <span class="font-medium text-indigo-700">{{ type.name }}</span>
          </button>
        </div>
      </div>

      <!-- Simulation -->
      <div class="bg-white p-4 rounded-xl shadow-lg border border-gray-200">
        <h2 class="text-xl font-bold mb-4 text-gray-700 border-b pb-2">Simulation & Export</h2>
        <div class="mb-4">
          <label class="block text-gray-600 font-medium text-sm mb-1">Incident Angle (deg)</label>
          <input type="number" min="-90" max="90" v-model.number="controls.angle_of_incidence_deg"
            class="w-full p-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500" />
        </div>
        <h3 class="text-base font-semibold mt-4 text-gray-700">Frequency Sweep (Wavelength)</h3>
        <div class="grid grid-cols-3 gap-2 mt-2 text-sm">
          <div v-for="(value,key) in controls.frequency_sweep" :key="key">
            <label class="block text-gray-500 capitalize">{{ key.replace('_',' ') }}</label>
            <input type="number" v-model.number="controls.frequency_sweep[key]"
              class="w-full p-2 border border-gray-300 rounded-md" />
          </div>
        </div>

        <button @click="exportSetup"
          class="mt-6 w-full flex items-center justify-center py-3 px-4 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition-colors">
          <i class="lucide lucide-download mr-2" style="width:20px;height:20px;"></i>
          Download Setup JSON
        </button>

        <button @click="runSimulation" :disabled="isSimulating"
          class="mt-2 w-full flex items-center justify-center py-3 px-4 text-white font-semibold rounded-lg shadow-md transition-colors"
          :class="isSimulating ? 'bg-gray-400 cursor-not-allowed' : 'bg-green-500 hover:bg-green-600'">
          <span v-if="isSimulating" class="animate-spin mr-2 border-t-2 border-white rounded-full h-5 w-5"></span>
          <i v-else class="lucide lucide-zap mr-2" style="width:20px;height:20px;"></i>
          {{ isSimulating ? 'Simulating...' : 'Run Simulation' }}
        </button>
      </div>
    </div>

    <!-- Center Panel -->
    <div class="w-full lg:w-2/4 aspect-square">
      <div ref="gridContainer"
        class="relative w-full h-full bg-white rounded-xl shadow-2xl border-4 border-gray-100/50 overflow-hidden"
        @mousemove="handleDragMove" @mouseup="handleDragEnd" @mouseleave="handleDragEnd" @click="handleGridClick">

        <!-- SVG Grid -->
        <svg class="absolute inset-0 w-full h-full z-10" viewBox="0 0 100 100">
          <g opacity="0.4" stroke-width="0.3" stroke="#CBD5E1">
            <line v-for="i in GRID_SIZE" :key="'h'+i" :y1="i*10" :y2="i*10" x1="0" x2="100"/>
            <line v-for="i in GRID_SIZE" :key="'v'+i" :x1="i*10" :x2="i*10" y1="0" y2="100"/>
          </g>
        </svg>

        <div class="absolute inset-0 z-20">
          <div v-for="comp in components" :key="comp.id"
            @click.stop="setSelectedComponentId(comp.id)"
            @mousedown.stop="startDrag(comp, $event)"
            class="absolute grid-cell cursor-move"
            :style="getComponentStyle(comp)">
            <div class="absolute inset-0 flex items-center justify-center">
              <div v-if="comp.type==='laser'" class="w-5 h-5 rounded-full bg-red-500 border-2 border-red-700"></div>
              <div v-else-if="comp.type==='mirror'" class="w-full h-1 bg-gradient-to-r from-gray-200 to-gray-500"></div>
              <div v-else-if="comp.type==='lens'" class="w-6 h-6 rounded-full border-2 border-blue-500 bg-blue-100/50"></div>
              <div v-else-if="comp.type==='beamsplitter'" class="w-4 h-4 bg-yellow-400 border-2 border-yellow-600 rotate-45"></div>
              <div v-else-if="comp.type==='detector'" class="w-6 h-6 bg-green-700 border-4 border-green-400"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Panel -->
    <div class="w-full lg:w-1/4 bg-white p-4 rounded-xl shadow-lg border border-gray-200">
      <h2 class="text-xl font-bold text-gray-700 border-b pb-2 mb-4">Component Properties</h2>
      <div v-if="!selectedComponent" class="text-gray-500">Select a component on the grid.</div>
      <div v-else>
        <h3 class="text-lg font-semibold text-indigo-600">{{ getComponentType(selectedComponent.type).name }}</h3>
        <p class="text-sm text-gray-500 mb-2">ID: {{ selectedComponent.id }}</p>

        <div class="grid grid-cols-2 gap-4 text-sm">
          <div>
            <label class="block text-gray-600 font-medium">X</label>
            <input type="number" v-model.number="selectedComponent.position.x"
              @input="updateComponentPosition(selectedComponent.id, selectedComponent.position.x, selectedComponent.position.y)"
              class="w-full mt-1 p-2 border border-gray-300 rounded-md" />
          </div>
          <div>
            <label class="block text-gray-600 font-medium">Y</label>
            <input type="number" v-model.number="selectedComponent.position.y"
              @input="updateComponentPosition(selectedComponent.id, selectedComponent.position.x, selectedComponent.position.y)"
              class="w-full mt-1 p-2 border border-gray-300 rounded-md" />
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer class="mt-8 text-center text-gray-500 text-sm border-t pt-4">
    <p>Contact: 0000000000 | Email: Ritik Gupta</p>
  </footer>
</div>

<script>
const { createApp, ref, reactive, computed, onMounted } = Vue;

createApp({
  setup() {
    const GRID_SIZE = 10;
    const COMPONENT_TYPES = [
      { id:'laser', name:'Laser Source', icon:'lucide-sun-dim', defaultProps:{angle:0,power_mw:10,wavelength_nm:650}},
      { id:'mirror', name:'Mirror', icon:'lucide-refresh-ccw', defaultProps:{angle:45,reflectivity:99.5}},
      { id:'lens', name:'Lens', icon:'lucide-target', defaultProps:{angle:0,focal_length_mm:50}},
      { id:'beamsplitter', name:'Beam Splitter', icon:'lucide-shuffle', defaultProps:{angle:45,reflectivity:50,transmissivity:50}},
      { id:'detector', name:'Photodetector', icon:'lucide-layout-grid', defaultProps:{angle:90,area_mm2:10}},
    ];
    const components = ref([]);
    const selectedComponentId = ref(null);
    const message = ref('');
    const messageType = ref('success');
    const controls = reactive({
      angle_of_incidence_deg: 0,
      frequency_sweep: { start_nm:400, stop_nm:700, points:11 }
    });

    const selectedComponent = computed(() => components.value.find(c=>c.id===selectedComponentId.value));

    onMounted(()=>{
      components.value=[
        {id:'laser-1',type:'laser',position:{x:1,y:5},properties:{angle:0,power_mw:10,wavelength_nm:650}},
        {id:'mirror-2',type:'mirror',position:{x:6,y:5},properties:{angle:45,reflectivity:99.5}},
        {id:'detector-3',type:'detector',position:{x:10,y:1},properties:{angle:90,area_mm2:10}},
      ];
    });

    const getComponentType = id => COMPONENT_TYPES.find(t=>t.id===id);
    const getComponentStyle = comp => ({
      left: `${comp.position.x*10}%`,
      top: `${comp.position.y*10}%`,
      width: '10%',
      height: '10%',
      transform: 'translate(-50%,-50%)'
    });

    const showMessage = (msg, type='success')=>{
      message.value=msg;
      messageType.value=type;
      setTimeout(()=>message.value='',4000);
    };

    const placeComponent = (typeId)=>{
      const type = getComponentType(typeId);
      const id = `${typeId}-${Date.now()}`;
      components.value.push({id,type:typeId,position:{x:5,y:5},properties:{...type.defaultProps}});
      selectedComponentId.value = id;
      showMessage(`Placed ${type.name}`);
    };

    const updateComponentPosition=(id,x,y)=>{
      const comp = components.value.find(c=>c.id===id);
      if(comp){
        comp.position.x = Math.max(1,Math.min(GRID_SIZE,x));
        comp.position.y = Math.max(1,Math.min(GRID_SIZE,y));
      }
    };

    const setSelectedComponentId=(id)=>selectedComponentId.value=id;

    const handleGridClick=(e)=>{
      if(e.target===e.currentTarget) selectedComponentId.value=null;
    };

    const startDrag=()=>{};
    const handleDragMove=()=>{};
    const handleDragEnd=()=>{};
    const exportSetup=()=>showMessage('Download feature working!');
    const runSimulation=()=>showMessage('Simulation triggered!');

    return {
      GRID_SIZE, COMPONENT_TYPES, components, selectedComponentId, selectedComponent,
      message, messageType, controls,
      getComponentType, getComponentStyle, placeComponent, updateComponentPosition,
      setSelectedComponentId, handleGridClick, startDrag, handleDragMove, handleDragEnd,
      exportSetup, runSimulation
    };
  }
}).mount('#app');
</script>

</body>
</html>
